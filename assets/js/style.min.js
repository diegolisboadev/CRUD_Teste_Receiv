
// Scripts JS

// Mascara Dt Nascimento
new IMask(document.getElementById('dt_nascimento'), {
    mask: '00/00/0000'
});

// Mascara Dt Vencimento
new IMask(document.getElementById('dt_vencimento'), {
    mask: '00/00/0000'
});

// Mascara Valor (R$)
VMasker(document.getElementById("valor")).maskMoney();


// INICIO CPF e CNPJ - Mascara tanto CPF como CNPJ
// Colocar Formatação
document.getElementById('cpf_cnpj').addEventListener('focusout', (e) => {
    if (e.target.value.length <= 11) {
        e.target.value = e.target.value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/g,"\$1.\$2.\$3\-\$4");
    } else {
        e.target.value = e.target.value.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/g,"\$1.\$2.\$3\/\$4\-\$5");
    }
});

// Retirar Formatação 
document.getElementById('cpf_cnpj').addEventListener('focusin', (e) => {
    e.target.value = e.target.value.replace(/(\.|\/|\-)/g,"");
});
// FIM CPF e CNPJ - Mascara tanto CPF como CNPJ

// Requisições JS

// Retorna Dados para a Listagem e Popula a Tabela de Listagem Devedores Via JS
fetchApi(`${basePath()}/listagem.php`)
.then(data => { 
    const dataListagem = data;
    console.log(dataListagem)

    var conteudoTable = '';
    for(let [i, registro] of dataListagem.entries()) {
        conteudoTable += `<tr class="text-center">
                <td>${i + 1}</td>
                <td>${registro.nome}</td>
                <td>${registro.descricao}</td>
                <td>${dinheiroFormatoBrl(registro.valor)}</td>
                <td>${formateDate(registro.created_at, true)}</td>
                <td>${formateDate(registro.dt_vencimento)}</td>
                <td>
                    <button type="button" data-id=${registro.id} class="btn btn-outline-secondary" title="Info"><i class="fa fa-info fa-1x"></i></button>
                    &emsp;
                    <button type="button" data-id=${registro.id} class="btn btn-outline-info" title="Editar"><i class="fa fa-edit fa-1x"></i></button>
                    &emsp;
                    <button type="button" data-id=${registro.id} class="btn btn-outline-danger" title="Excluir"><i class="fa fa-trash fa-1x"></i></button>
                </td>
        </tr>`
    }

    document.getElementById('tbody').innerHTML = conteudoTable; 

});